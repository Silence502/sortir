{% extends 'base.html.twig' %}

{% block title %}
    Liste des sorties | {{ parent() }}
{% endblock %}

{% block body %}
    <section>
        {{ form_start(searchForm) }}
        {{ form_widget(searchForm) }}
        <button>Rechercher</button>
        {{ form_end(searchForm) }}
    </section>

    <section>
        {% if trips|length > 0 %}
            <table>
                <tr>
                    <th>Nom de la sortie</th>
                    <th>Date de la sortie</th>
                    <th>Clôture</th>
                    <th>inscrits/places</th>
                    <th>Etat</th>
                    <th>Inscrit</th>
                    <th>Organisateur</th>
                    <th>Actions</th>
                </tr>
                {% for trip in trips %}
                    <tr>
                        <td>
                            <a href="{{ path('sortie_details', {'id': trip.id}) }}"
                               title="Sortie: {{ trip.name }}">
                                {{ trip.name }}
                            </a>
                        </td>
                        <td>{{ trip.dateStartTime|date(
                                "d/m/Y h:m"
                            ) }}</td>
                        <td>{{ trip.registrationDeadline|date(
                                "d/m/Y"
                            ) }}</td>
                        <td>{{ trip.usersRegistered|length }}/{{ trip.maxRegistrations }}</td>
                        <td>{{ trip.state.wording }}</td>
                        <td>
                            {% for userRegistered in trip.usersRegistered %}
                                {% if userRegistered.id == user.id %}
                                    X
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td>{{ trip.organizer.nickname }}</td>
                        <td>
                            <a href="{{ path('sortie_details', {'id': trip.id}) }}"
                               title="Sortie: {{ trip.name }}">
                                Afficher
                            </a>
                            <span> - </span>
                            {# Inscription ou désinscription #}
                            {% set peutInscrire = true %}
                            {% for userRegistered in trip.usersRegistered %}
                                {% if userRegistered.id == user.id %}
                                    {% set peutInscrire = false %}
                                {% endif %}
                            {% endfor %}
                            {% if peutInscrire %}
                                <a href="{{ path('sortie_sInscrire',{id: trip.id}) }}" title="S'inscrire">
                                    S'inscrire
                                </a>
                            {% else %}
                                <a href="{{ path('sortie_seDesister',{id: trip.id}) }}" title="Se désister">
                                    Se désister
                                </a>
                            {% endif %}
                        </td>
                    </tr>

                {% endfor %}
            </table>
        {% else %}
            Pas de sortie
        {% endif %}
    </section>
    <button>
        <a href="{{ path('sortie_creer') }}" title="Créer une sortie">
            Créer une sortie
        </a>
    </button>
{% endblock %}

